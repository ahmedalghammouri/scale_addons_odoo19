<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="truck_weighing_view_form_sale" model="ir.ui.view">
        <field name="name">truck.weighing.view.form.sale</field>
        <field name="model">truck.weighing</field>
        <field name="inherit_id" ref="inventory_scale_integration_stock_out.truck_weighing_view_form_stock_out"/>
        <field name="arch" type="xml">
            <field name="delivery_id" position="after">
                <field name="picking_id" invisible="operation_type == 'outgoing'"/>
            </field>
            <field name="partner_id" position="attributes">
                <attribute name="readonly">picking_id or delivery_id or sale_order_id</attribute>
                <attribute name="force_save">1</attribute>
            </field>
            <field name="product_id" position="attributes">
                <attribute name="readonly">picking_id or delivery_id or sale_order_id</attribute>
                <attribute name="force_save">1</attribute>
            </field>
            <field name="operation_type" position="attributes">
                <attribute name="readonly">picking_id or delivery_id or sale_order_id</attribute>
                <attribute name="force_save">1</attribute>
            </field>

            <xpath expr="//group[@name='stock_operations_out']" position="after">
                <group name="sale_order_group" string="Sale Order" invisible="operation_type != 'outgoing'">
                    <group>
                        <field name="sale_order_id" domain="[('partner_id', '=', partner_id), ('state', 'in', ['sale', 'done']), ('order_line.product_id.is_weighable', '=', True)]" options="{'no_create': True}" readonly="delivery_id" force_save="1"/>
                    </group>
                    <group>
                        <field name="sale_line_id" domain="[('order_id', '=', sale_order_id), ('product_id.is_weighable', '=', True)]" options="{'no_create': True}" invisible="not sale_order_id" readonly="delivery_id or sale_order_id" force_save="1"/>
                    </group>
                </group>
            </xpath>
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_view_sale_order" type="object" class="oe_stat_button" icon="fa-shopping-bag"
                        invisible="not sale_order_id or operation_type != 'outgoing'">
                    <div class="o_stat_info">
                        <span class="o_stat_text">Sale Order</span>
                    </div>
                </button>
            </xpath>
        </field>
    </record>

    <record id="truck_weighing_view_kanban_sale" model="ir.ui.view">
        <field name="name">truck.weighing.view.kanban.sale</field>
        <field name="model">truck.weighing</field>
        <field name="inherit_id" ref="inventory_scale_integration_stock_out.truck_weighing_view_kanban_stock_out"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='variance_qty']" position="after">
                <field name="sale_order_id"/>
            </xpath>
            <xpath expr="//div[hasclass('mb-2')][last()]" position="after">
                <div t-if="record.sale_order_id.raw_value" class="mb-2 p-2 border border-warning rounded">
                    <i class="fa fa-shopping-bag text-warning" title="Sale Order"/> <strong>SO:</strong> <t t-out="record.sale_order_id.value"/>
                </div>
            </xpath>
        </field>
    </record>

    <record id="truck_weighing_view_list_sale" model="ir.ui.view">
        <field name="name">truck.weighing.view.list.sale</field>
        <field name="model">truck.weighing</field>
        <field name="inherit_id" ref="inventory_scale_integration_stock_out.truck_weighing_view_list_stock_out"/>
        <field name="arch" type="xml">
            <field name="location_dest_id" position="after">
                <field name="sale_order_id" optional="show" decoration-warning="sale_order_id" decoration-bf="1"/>
                <field name="sale_line_id" optional="hide"/>
            </field>
        </field>
    </record>

    <record id="truck_weighing_view_graph_sale" model="ir.ui.view">
        <field name="name">truck.weighing.view.graph.sale</field>
        <field name="model">truck.weighing</field>
        <field name="inherit_id" ref="inventory_scale_integration_stock_out.truck_weighing_view_graph_stock_out"/>
        <field name="arch" type="xml">
            <field name="operation_type" position="after">
                <field name="sale_order_id"/>
            </field>
        </field>
    </record>

    <record id="truck_weighing_view_pivot_sale" model="ir.ui.view">
        <field name="name">truck.weighing.view.pivot.sale</field>
        <field name="model">truck.weighing</field>
        <field name="inherit_id" ref="inventory_scale_integration_stock_out.truck_weighing_view_pivot_stock_out"/>
        <field name="arch" type="xml">
            <field name="operation_type" position="after">
                <field name="sale_order_id" type="col"/>
            </field>
        </field>
    </record>

    <record id="truck_weighing_view_search_sale" model="ir.ui.view">
        <field name="name">truck.weighing.view.search.sale</field>
        <field name="model">truck.weighing</field>
        <field name="inherit_id" ref="inventory_scale_integration_stock_out.truck_weighing_view_search_stock_out"/>
        <field name="arch" type="xml">
            <field name="location_dest_id" position="after">
                <field name="sale_order_id"/>
                <field name="sale_line_id"/>
            </field>
            <filter name="with_delivery" position="after">
                <filter string="With Sale Order" name="with_so" domain="[('sale_order_id', '!=', False)]"/>
                <filter string="Without Sale Order" name="without_so" domain="[('sale_order_id', '=', False), ('operation_type', '=', 'outgoing')]"/>
            </filter>
            <filter name="group_location" position="after">
                <filter string="Sale Order" name="group_so" domain="[]" context="{'group_by':'sale_order_id'}"/>
                <filter string="Customer" name="group_customer" domain="[]" context="{'group_by':'partner_id'}"/>
            </filter>
        </field>
    </record>
</odoo>
