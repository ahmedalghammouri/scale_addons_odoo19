<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="inventory_scale_integration.WeighingDashboardTemplate" owl="1">
        <div class="o_weighing_dashboard">
            <div class="container-fluid" t-if="!state.loading">
                <!-- Professional Header with Quick Actions -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card shadow-sm card-header bg-primary " >
                            <div class="card-body py-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h3 class="mb-1"><i class="fa fa-tachometer-alt mr-2"/>Weighing Operations Dashboard</h3>
                                        <!-- <p class="text-white-50 mb-0" style="font-size: 0.9rem;">Real-time monitoring and control center</p> -->
                                    </div>
                                    <div class="d-flex flex-wrap align-items-center" style="gap: 0.5rem;">
                                        <button class="btn btn-light btn-sm shadow-sm" style="padding: 0.375rem 0.75rem;" t-on-click="() => this.onCardAction('new_weighing')">
                                            <i class="fa fa-plus-circle text-success" style="margin-right: 0.5rem;"/>New Weighing
                                        </button>
                                        <button class="btn btn-light btn-sm shadow-sm" style="padding: 0.375rem 0.75rem;" t-on-click="() => this.onCardAction('truck_fleet')">
                                            <i class="fa fa-truck text-info" style="margin-right: 0.5rem;"/>Truck Fleet
                                        </button>
                                        <button class="btn btn-light btn-sm shadow-sm" style="padding: 0.375rem 0.75rem;" t-on-click="() => this.onCardAction('scale_settings')">
                                            <i class="fa fa-cog text-warning" style="margin-right: 0.5rem;"/>Settings
                                        </button>
                                        <button class="btn btn-light btn-sm shadow-sm" style="padding: 0.375rem 0.75rem;" t-on-click="() => this.onCardAction('reports')">
                                            <i class="fa fa-chart-line text-primary" style="margin-right: 0.5rem;"/>Reports
                                        </button>
                                        <button class="btn btn-light btn-sm shadow-sm" style="padding: 0.375rem 0.75rem;" t-on-click="refreshData">
                                            <i class="fa fa-sync-alt text-success" style="margin-right: 0.5rem;"/>Refresh
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Key Analytics Charts -->
                <div class="row mb-4">
                    <!-- Workflow Status Chart -->
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card shadow-sm" style="border-left: 4px solid #667eea;">
                            <div class="card-body py-2 px-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted font-weight-bold">Workflow Status</small>
                                    <i class="fa fa-tasks text-primary"/>
                                </div>
                                <div class="progress mb-2" style="height: 12px;">
                                    <div class="progress-bar bg-info" t-att-style="'width: ' + (state.data.all_records?.draft_percent || 0) + '%'"/>
                                    <div class="progress-bar bg-primary " t-att-style="'width: ' + (state.data.all_records?.first_percent || 0) + '%'"/>
                                    <div class="progress-bar bg-warning" t-att-style="'width: ' + (state.data.all_records?.second_percent || 0) + '%'"/>
                                    <div class="progress-bar bg-success" t-att-style="'width: ' + (state.data.all_records?.done_percent || 0) + '%'"/>
                                </div>
                                <div class="d-flex justify-content-between" style="font-size: 0.65rem;">
                                    <span class="text-info">Draft</span>
                                    <span class="text-primary">1st</span>
                                    <span class="text-warning">2nd</span>
                                    <span class="text-success">Done</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Completion Rate Chart -->
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card shadow-sm" style="border-left: 4px solid #28a745;">
                            <div class="card-body py-2 px-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted font-weight-bold">Completion Rate</small>
                                    <i class="fa fa-check-circle text-success"/>
                                </div>
                                <div class="d-flex align-items-center">
                                    <h3 class="mb-0 mr-2" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700;" t-esc="(state.data.all_records?.done_percent || 0) + '%'"/>
                                    <small class="text-muted">completed</small>
                                </div>
                                <div class="progress mt-2" style="height: 8px;">
                                    <div class="progress-bar bg-success" t-att-style="'width: ' + (state.data.all_records?.done_percent || 0) + '%'"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Accuracy Metric Chart -->
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card shadow-sm" style="border-left: 4px solid #17a2b8;">
                            <div class="card-body py-2 px-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted font-weight-bold">Weight Accuracy</small>
                                    <i class="fa fa-bullseye text-info"/>
                                </div>
                                <div class="d-flex align-items-center">
                                    <h3 class="mb-0 mr-2" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700;" t-esc="(state.data.stock_performance?.accuracy_rate || 0) + '%'"/>
                                    <small class="text-muted">±5%</small>
                                </div>
                                <div class="progress mt-2" style="height: 8px;">
                                    <div class="progress-bar bg-info" t-att-style="'width: ' + (state.data.stock_performance?.accuracy_rate || 0) + '%'"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Truck Utilization Chart -->
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card shadow-sm" t-att-style="'border-left: 4px solid ' + ((state.data.truck_performance?.utilization_rate || 0) >= 80 ? '#28a745' : (state.data.truck_performance?.utilization_rate || 0) >= 50 ? '#ffc107' : '#dc3545')">
                            <div class="card-body py-2 px-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted font-weight-bold">Utilization Rate</small>
                                    <i class="fa fa-truck" t-att-class="'fa fa-truck text-' + this.getProgressColor(state.data.truck_performance?.utilization_rate || 0)"/>
                                </div>
                                <div class="d-flex align-items-center">
                                    <h3 class="mb-0 mr-2" t-att-class="'mb-0 mr-2 text-' + this.getProgressColor(state.data.truck_performance?.utilization_rate || 0)" style="font-weight: 700;" t-esc="(state.data.truck_performance?.utilization_rate || 0) + '%'"/>
                                    <small class="text-muted">active</small>
                                </div>
                                <div class="progress mt-2" style="height: 8px;">
                                    <div class="progress-bar" t-att-class="'progress-bar bg-' + this.getProgressColor(state.data.truck_performance?.utilization_rate || 0)" t-att-style="'width: ' + (state.data.truck_performance?.utilization_rate || 0) + '%'"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weighing Records Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="section-header mb-3">
                            <h4><i class="fa fa-balance-scale m-2"/>Weighing Records</h4>
                        </div>
                    </div>
                    
                    <!-- Awaiting Initial Weigh -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary d-flex justify-content-between align-items-center">
                                <h5 class="m-2"><i class="fa fa-hourglass-start m-2"/>Awaiting Initial Weigh</h5>
                                <span class="badge badge-light" style="font-size: 1.5rem;" t-esc="(state.data.draft_details?.incoming_count || 0) + (state.data.draft_details?.outgoing_count || 0)"/>
                            </div>
                            <div class="position-absolute" style="top: 10px; right: 10px; opacity: 0.1;">
                                <i class="fa fa-hourglass-start" style="font-size: 3rem;"/>
                            </div>
                            <div class="card-body">
                                <div class="row text-center mb-2">
                                    <div class="col-6">
                                        <h4 class="text-primary mb-0" style="cursor: pointer;" t-esc="state.data.draft_details?.incoming_count || 0" t-on-click="() => this.onCardAction('weighing_draft_incoming')"/>
                                        <small class="text-muted">Incoming</small>
                                    </div>
                                    <div class="col-6">
                                        <h4 class="text-warning mb-0" style="cursor: pointer;" t-esc="state.data.draft_details?.outgoing_count || 0" t-on-click="() => this.onCardAction('weighing_draft_outgoing')"/>
                                        <small class="text-muted">Outgoing</small>
                                    </div>
                                </div>
                                <hr class="my-2"/>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <h5 class="text-success mb-0" style="cursor: pointer;" t-esc="state.data.draft_details?.with_truck || 0" t-on-click="() => this.onCardAction('weighing_draft')"/>
                                        <small class="text-muted"><i class="fa fa-truck"/> With Truck</small>
                                    </div>
                                    <div class="col-6">
                                        <h5 class="text-danger mb-0" style="cursor: pointer;" t-esc="state.data.draft_details?.without_truck || 0" t-on-click="() => this.onCardAction('weighing_draft')"/>
                                        <small class="text-muted"><i class="fa fa-exclamation-triangle"/> No Truck</small>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-info btn-sm btn-block" t-on-click="() => this.onCardAction('weighing_draft')">
                                    <i class="fa fa-list"/> View All
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- First Weighing Captured -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary d-flex justify-content-between align-items-center">
                                <h5 class="m-2"><i class="fa fa-weight m-2"/>First Weighing Captured</h5>
                                <span class="badge badge-light" style="font-size: 1.5rem;" t-esc="(state.data.in_progress_incoming?.first_count || 0) + (state.data.in_progress_outgoing?.first_count || 0)"/>
                            </div>
                            <div class="position-absolute" style="top: 10px; right: 10px; opacity: 0.1;">
                                <i class="fa fa-weight" style="font-size: 3rem;"/>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-2">
                                    <h4 class="text-primary mb-0" style="cursor: pointer;" t-esc="this.formatWeight(state.data.in_progress_incoming?.first_weight || 0)" t-on-click="() => this.onCardAction('weighing_first_incoming')"/>
                                    <small class="text-muted">Incoming (Gross)</small>
                                </div>
                                <div class="text-center mb-3">
                                    <h4 class="text-warning mb-0" style="cursor: pointer;" t-esc="this.formatWeight(state.data.in_progress_outgoing?.first_weight || 0)" t-on-click="() => this.onCardAction('weighing_first_outgoing')"/>
                                    <small class="text-muted">Outgoing (Tare)</small>
                                </div>
                                <hr/>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <h5 class="text-primary mb-0" style="cursor: pointer;" t-esc="state.data.in_progress_incoming?.first_count || 0" t-on-click="() => this.onCardAction('weighing_first_incoming')"/>
                                        <small class="text-muted">Incoming</small>
                                    </div>
                                    <div class="col-6">
                                        <h5 class="text-warning mb-0" style="cursor: pointer;" t-esc="state.data.in_progress_outgoing?.first_count || 0" t-on-click="() => this.onCardAction('weighing_first_outgoing')"/>
                                        <small class="text-muted">Outgoing</small>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-primary btn-sm btn-block" t-on-click="() => this.onCardAction('weighing_first')">
                                    <i class="fa fa-list"/> View All
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Second Weighing Captured -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary text-dark d-flex justify-content-between align-items-center">
                                <h5 class="m-2"><i class="fa fa-clock m-2"/>Second Weighing Captured</h5>
                                <span class="badge badge-dark" style="font-size: 1.5rem;" t-esc="(state.data.in_progress_incoming?.second_count || 0) + (state.data.in_progress_outgoing?.second_count || 0)"/>
                            </div>
                            <div class="position-absolute" style="top: 10px; right: 10px; opacity: 0.1;">
                                <i class="fa fa-clock" style="font-size: 3rem;"/>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-2">
                                    <h4 class="text-primary mb-0" style="cursor: pointer;" t-esc="this.formatWeight(state.data.in_progress_incoming?.second_weight || 0)" t-on-click="() => this.onCardAction('weighing_second_incoming')"/>
                                    <small class="text-muted">Incoming (Tare)</small>
                                </div>
                                <div class="text-center mb-3">
                                    <h4 class="text-warning mb-0" style="cursor: pointer;" t-esc="this.formatWeight(state.data.in_progress_outgoing?.second_weight || 0)" t-on-click="() => this.onCardAction('weighing_second_outgoing')"/>
                                    <small class="text-muted">Outgoing (Gross)</small>
                                </div>
                                <hr/>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <h5 class="text-primary mb-0" style="cursor: pointer;" t-esc="state.data.in_progress_incoming?.second_count || 0" t-on-click="() => this.onCardAction('weighing_second_incoming')"/>
                                        <small class="text-muted">Incoming</small>
                                    </div>
                                    <div class="col-6">
                                        <h5 class="text-danger mb-0" style="cursor: pointer;" t-esc="state.data.in_progress_outgoing?.second_count || 0" t-on-click="() => this.onCardAction('weighing_second_outgoing')"/>
                                        <small class="text-muted">Outgoing</small>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-warning btn-sm btn-block" t-on-click="() => this.onCardAction('weighing_second')">
                                    <i class="fa fa-list"/> View All
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- All Records -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary d-flex justify-content-between align-items-center">
                                <h5 class="m-2"><i class="fa fa-check-circle m-2"/>All Records</h5>
                                <span class="badge badge-light" style="font-size: 1.5rem;" t-esc="state.data.all_records?.total_count || 0"/>
                            </div>
                            <div class="position-absolute" style="top: 10px; right: 10px; opacity: 0.1;">
                                <i class="fa fa-check-circle" style="font-size: 3rem;"/>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-2">
                                    <h4 class="text-success mb-0" style="cursor: pointer;" t-esc="this.formatWeight(state.data.all_records?.total_weight_today || 0)" t-on-click="() => this.onCardAction('completed_today')"/>
                                    <small class="text-muted">Today's Net Weight</small>
                                </div>
                                <hr class="my-2"/>
                                <!-- Progress Chart -->
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <small class="text-muted">Status Distribution</small>
                                        <small class="text-success font-weight-bold" t-esc="(state.data.all_records?.done_percent || 0) + '%'"/>
                                    </div>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar bg-info" role="progressbar" t-att-style="'width: ' + (state.data.all_records?.draft_percent || 0) + '%'" t-att-title="'Draft: ' + (state.data.all_records?.draft_percent || 0) + '%'"/>
                                        <div class="progress-bar bg-primary " role="progressbar" t-att-style="'width: ' + (state.data.all_records?.first_percent || 0) + '%'" t-att-title="'First: ' + (state.data.all_records?.first_percent || 0) + '%'"/>
                                        <div class="progress-bar bg-warning" role="progressbar" t-att-style="'width: ' + (state.data.all_records?.second_percent || 0) + '%'" t-att-title="'Second: ' + (state.data.all_records?.second_percent || 0) + '%'"/>
                                        <div class="progress-bar bg-success" role="progressbar" t-att-style="'width: ' + (state.data.all_records?.done_percent || 0) + '%'" t-att-title="'Done: ' + (state.data.all_records?.done_percent || 0) + '%'"/>
                                    </div>
                                    <div class="d-flex justify-content-between mt-1" style="font-size: 0.7rem;">
                                        <span class="text-info"><i class="fa fa-square"/> Draft</span>
                                        <span class="text-primary"><i class="fa fa-square"/> 1st</span>
                                        <span class="text-warning"><i class="fa fa-square"/> 2nd</span>
                                        <span class="text-success"><i class="fa fa-square"/> Done</span>
                                    </div>
                                </div>
                                <hr class="my-2"/>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <h6 class="text-info mb-0" style="cursor: pointer;" t-esc="state.data.all_records?.completed_today || 0" t-on-click="() => this.onCardAction('completed_today')"/>
                                        <small class="text-muted">Today</small>
                                    </div>
                                    <div class="col-6">
                                        <h6 class="text-success mb-0" style="cursor: pointer;" t-esc="state.data.all_records?.completed_week || 0" t-on-click="() => this.onCardAction('completed_week')"/>
                                        <small class="text-muted">This Week</small>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-success btn-sm btn-block" t-on-click="() => this.onCardAction('all_records')">
                                    <i class="fa fa-list"/> View All
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Tabs Section -->
                <div class="row mt-4 mb-4">
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <ul class="nav nav-tabs card-header-tabs" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link" t-att-class="state.activeTab === 'stock' ? 'active' : ''" t-on-click="() => this.setActiveTab('stock')" style="cursor: pointer;">
                                            <i class="fa fa-chart-line"/> Stock Performance
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" t-att-class="state.activeTab === 'waiting' ? 'active' : ''" t-on-click="() => this.setActiveTab('waiting')" style="cursor: pointer;">
                                            <i class="fa fa-hourglass-half"/> Waiting Time
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" t-att-class="state.activeTab === 'truck' ? 'active' : ''" t-on-click="() => this.setActiveTab('truck')" style="cursor: pointer;">
                                            <i class="fa fa-truck"/> Truck Performance
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-body">
                                <!-- Stock Performance Tab -->
                                <div t-if="state.activeTab === 'stock'" class="tab-content-wrapper">
                                    <div class="row">
                    
                    <!-- Fulfillment Analysis Card -->
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary d-flex justify-content-between align-items-center">
                                <h5 class="m-2"><i class="fa fa-chart-pie m-2"/>Fulfillment Analysis</h5>
                                <span class="badge badge-light" style="font-size: 1.5rem;" t-esc="state.data.stock_performance?.total_completed || 0"/>
                            </div>
                            <div class="position-absolute" style="top: 10px; right: 10px; opacity: 0.1;">
                                <i class="fa fa-chart-pie" style="font-size: 3rem;"/>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-2">
                                    <h3 class="mb-0" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700;" t-esc="(state.data.stock_performance?.avg_fulfillment || 0) + '%'"/>
                                    <small class="text-muted">Avg Fulfillment Rate</small>
                                </div>
                                <hr class="my-2"/>
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small class="text-muted">Fulfillment Distribution</small>
                                    </div>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar bg-success" role="progressbar" t-att-style="'width: ' + ((state.data.stock_performance?.high_fulfillment || 0) / Math.max(state.data.stock_performance?.total_completed || 1, 1) * 100) + '%'" t-att-title="'High: ' + (state.data.stock_performance?.high_fulfillment || 0)"/>
                                        <div class="progress-bar bg-primary " role="progressbar" t-att-style="'width: ' + ((state.data.stock_performance?.exact_match || 0) / Math.max(state.data.stock_performance?.total_completed || 1, 1) * 100) + '%'" t-att-title="'Exact: ' + (state.data.stock_performance?.exact_match || 0)"/>
                                        <div class="progress-bar bg-info" role="progressbar" t-att-style="'width: ' + ((state.data.stock_performance?.over_delivered || 0) / Math.max(state.data.stock_performance?.total_completed || 1, 1) * 100) + '%'" t-att-title="'Over: ' + (state.data.stock_performance?.over_delivered || 0)"/>
                                        <div class="progress-bar bg-warning" role="progressbar" t-att-style="'width: ' + ((state.data.stock_performance?.under_delivered || 0) / Math.max(state.data.stock_performance?.total_completed || 1, 1) * 100) + '%'" t-att-title="'Under: ' + (state.data.stock_performance?.under_delivered || 0)"/>
                                    </div>
                                    <div class="d-flex justify-content-between mt-1" style="font-size: 0.7rem;">
                                        <span class="text-success"><i class="fa fa-square"/> High</span>
                                        <span class="text-primary"><i class="fa fa-square"/> Exact</span>
                                        <span class="text-info"><i class="fa fa-square"/> Over</span>
                                        <span class="text-warning"><i class="fa fa-square"/> Under</span>
                                    </div>
                                </div>
                                <hr class="my-2"/>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <h6 class="text-success mb-0" style="cursor: pointer;" t-esc="state.data.stock_performance?.high_fulfillment || 0" t-on-click="() => this.onCardAction('high_fulfillment')"/>
                                        <small class="text-muted">High (95%+)</small>
                                    </div>
                                    <div class="col-6">
                                        <h6 class="text-warning mb-0" style="cursor: pointer;" t-esc="state.data.stock_performance?.under_delivered || 0" t-on-click="() => this.onCardAction('under_delivered')"/>
                                        <small class="text-muted">Under</small>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-success btn-sm btn-block" t-on-click="() => this.onCardAction('avg_fulfillment')">
                                    <i class="fa fa-chart-bar"/> View Analysis
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Weight Operations Summary Card -->
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary d-flex justify-content-between align-items-center">
                                <h5 class="m-2"><i class="fa fa-balance-scale m-2"/>Weight Operations</h5>
                                <span class="badge badge-light" style="font-size: 1.5rem;" t-esc="(state.data.stock_performance?.receipts_count || 0) + (state.data.stock_performance?.deliveries_count || 0)"/>
                            </div>
                            <div class="position-absolute" style="top: 10px; right: 10px; opacity: 0.1;">
                                <i class="fa fa-balance-scale" style="font-size: 3rem;"/>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-2">
                                    <h5 class="text-primary mb-0" style="cursor: pointer;" t-esc="this.formatWeight(state.data.stock_performance?.total_received || 0)" t-on-click="() => this.onCardAction('total_received')"/>
                                    <small class="text-muted">Total Received</small>
                                </div>
                                <div class="text-center mb-2">
                                    <h5 class="text-warning mb-0" style="cursor: pointer;" t-esc="this.formatWeight(state.data.stock_performance?.total_delivered || 0)" t-on-click="() => this.onCardAction('total_delivered')"/>
                                    <small class="text-muted">Total Delivered</small>
                                </div>
                                <hr class="my-2"/>
                                <div class="row text-center mb-2">
                                    <div class="col-6">
                                        <h6 class="text-primary mb-0" style="cursor: pointer;" t-esc="state.data.stock_performance?.receipts_count || 0" t-on-click="() => this.onCardAction('total_received')"/>
                                        <small class="text-muted">Receipts</small>
                                    </div>
                                    <div class="col-6">
                                        <h6 class="text-warning mb-0" style="cursor: pointer;" t-esc="state.data.stock_performance?.deliveries_count || 0" t-on-click="() => this.onCardAction('total_delivered')"/>
                                        <small class="text-muted">Deliveries</small>
                                    </div>
                                </div>
                                <hr class="my-2"/>
                                <div class="text-center">
                                    <h6 class="text-info mb-0" style="cursor: pointer;" t-esc="state.data.stock_performance?.products_count || 0" t-on-click="() => this.onCardAction('top_products')"/>
                                    <small class="text-muted"><i class="fa fa-cube"/> Products Weighed</small>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-primary btn-sm btn-block" t-on-click="() => this.onCardAction('reports')">
                                    <i class="fa fa-chart-line"/> View Reports
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Accuracy & Variance Card -->
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary d-flex justify-content-between align-items-center">
                                <h5 class="m-2"><i class="fa fa-bullseye m-2"/>Accuracy and Variance</h5>
                                <span class="badge badge-light" style="font-size: 1.5rem;" t-esc="(state.data.stock_performance?.accuracy_rate || 0) + '%'"/>
                            </div>
                            <div class="position-absolute" style="top: 10px; right: 10px; opacity: 0.1;">
                                <i class="fa fa-bullseye" style="font-size: 3rem;"/>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-2">
                                    <h3 class="mb-0" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700;" t-esc="(state.data.stock_performance?.accuracy_rate || 0) + '%'"/>
                                    <small class="text-muted">Accuracy Rate (±5%)</small>
                                </div>
                                <hr class="my-2"/>
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small class="text-muted">Accuracy Progress</small>
                                        <small class="text-info font-weight-bold" t-esc="(state.data.stock_performance?.accuracy_rate || 0) + '%'"/>
                                    </div>
                                    <div class="progress" style="height: 15px;">
                                        <div class="progress-bar bg-info" role="progressbar" t-att-style="'width: ' + (state.data.stock_performance?.accuracy_rate || 0) + '%'"/>
                                    </div>
                                </div>
                                <hr class="my-2"/>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <h6 class="text-secondary mb-0" style="cursor: pointer;" t-esc="this.formatWeight(state.data.stock_performance?.total_variance || 0)" t-on-click="() => this.onCardAction('total_variance')"/>
                                        <small class="text-muted">Total Variance</small>
                                    </div>
                                    <div class="col-6">
                                        <h6 class="text-primary mb-0" style="cursor: pointer;" t-esc="state.data.stock_performance?.exact_match || 0" t-on-click="() => this.onCardAction('exact_match')"/>
                                        <small class="text-muted">Exact Match</small>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-info btn-sm btn-block" t-on-click="() => this.onCardAction('accuracy_rate')">
                                    <i class="fa fa-chart-bar"/> View Details
                                </button>
                            </div>
                        </div>
                    </div>
                                    </div>
                                </div>

                                <!-- Waiting Time Tab -->
                                <div t-if="state.activeTab === 'waiting'" class="tab-content-wrapper">
                                    <div class="row">
                    
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary ">
                                <h5 class="m-2"><i class="fa fa-clock m-2"/>Average Times</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <small class="text-muted">To First Weigh</small>
                                    <h5 class="text-primary" t-esc="this.formatTime(state.data.waiting_time_analysis?.avg_to_first || 0)"/>
                                </div>
                                <div class="mb-2">
                                    <small class="text-muted">To Second Weigh</small>
                                    <h5 class="text-warning" t-esc="this.formatTime(state.data.waiting_time_analysis?.avg_to_second || 0)"/>
                                </div>
                                <div class="mb-2">
                                    <small class="text-muted">To Done</small>
                                    <h5 class="text-success" t-esc="this.formatTime(state.data.waiting_time_analysis?.avg_to_done || 0)"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary ">
                                <h5 class="m-2"><i class="fa fa-chart-line m-2"/>Total Waiting Time</h5>
                            </div>
                            <div class="card-body text-center">
                                <h3 class="text-primary mb-2" t-esc="this.formatTime(state.data.waiting_time_analysis?.avg_total || 0)"/>
                                <small class="text-muted">Average Total</small>
                                <hr/>
                                <div class="row">
                                    <div class="col-6">
                                        <h6 class="text-success" t-esc="this.formatTime(state.data.waiting_time_analysis?.min_total || 0)"/>
                                        <small class="text-muted">Min</small>
                                    </div>
                                    <div class="col-6">
                                        <h6 class="text-danger" t-esc="this.formatTime(state.data.waiting_time_analysis?.max_total || 0)"/>
                                        <small class="text-muted">Max</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary ">
                                <h5 class="m-2"><i class="fa fa-calendar m-2"/>Period Averages</h5>
                            </div>
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <h5 class="text-info" t-esc="this.formatTime(state.data.waiting_time_analysis?.today_avg || 0)"/>
                                    <small class="text-muted">Today Average</small>
                                </div>
                                <hr/>
                                <div>
                                    <h5 class="text-success" t-esc="this.formatTime(state.data.waiting_time_analysis?.week_avg || 0)"/>
                                    <small class="text-muted">Week Average</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary  text-dark">
                                <h5 class="m-2"><i class="fa fa-tachometer-alt m-2"/>Processing Speed</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3" style="cursor: pointer;" t-on-click="() => this.onCardAction('waiting_time_fast')">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small class="text-muted">Fast (&lt;30min)</small>
                                        <span class="badge badge-success" t-esc="state.data.waiting_time_analysis?.fast_count || 0"/>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-success" t-att-style="'width: ' + ((state.data.waiting_time_analysis?.fast_count || 0) / Math.max((state.data.waiting_time_analysis?.fast_count || 0) + (state.data.waiting_time_analysis?.normal_count || 0) + (state.data.waiting_time_analysis?.slow_count || 0), 1) * 100) + '%'"/>
                                    </div>
                                </div>
                                <div class="mb-3" style="cursor: pointer;" t-on-click="() => this.onCardAction('waiting_time_normal')">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small class="text-muted">Normal (30-60min)</small>
                                        <span class="badge badge-warning" t-esc="state.data.waiting_time_analysis?.normal_count || 0"/>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-warning" t-att-style="'width: ' + ((state.data.waiting_time_analysis?.normal_count || 0) / Math.max((state.data.waiting_time_analysis?.fast_count || 0) + (state.data.waiting_time_analysis?.normal_count || 0) + (state.data.waiting_time_analysis?.slow_count || 0), 1) * 100) + '%'"/>
                                    </div>
                                </div>
                                <div class="mb-3" style="cursor: pointer;" t-on-click="() => this.onCardAction('waiting_time_slow')">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small class="text-muted">Slow (&gt;60min)</small>
                                        <span class="badge badge-danger" t-esc="state.data.waiting_time_analysis?.slow_count || 0"/>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-danger" t-att-style="'width: ' + ((state.data.waiting_time_analysis?.slow_count || 0) / Math.max((state.data.waiting_time_analysis?.fast_count || 0) + (state.data.waiting_time_analysis?.normal_count || 0) + (state.data.waiting_time_analysis?.slow_count || 0), 1) * 100) + '%'"/>
                                    </div>
                                </div>
                                <button class="btn btn-warning btn-sm btn-block" t-on-click="() => this.onCardAction('waiting_time_analysis')">
                                    <i class="fa fa-chart-bar"/> View Analysis
                                </button>
                            </div>
                        </div>
                    </div>
                                    </div>
                                </div>

                                <!-- Truck Performance Tab -->
                                <div t-if="state.activeTab === 'truck'" class="tab-content-wrapper">
                                    <div class="row">
                    
                    <!-- Efficiency Score Card -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary d-flex justify-content-between align-items-center">
                                <h5 class="m-2"><i class="fa fa-chart-line m-2"/>Efficiency Score</h5>
                                <span class="badge badge-light" style="font-size: 1.5rem;" t-esc="(state.data.truck_performance?.trips_per_truck || 0).toFixed(1)"/>
                            </div>
                            <div class="position-absolute" style="top: 10px; right: 10px; opacity: 0.1;">
                                <i class="fa fa-chart-line" style="font-size: 3rem;"/>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-2">
                                    <h3 class="mb-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700;" t-esc="(state.data.truck_performance?.trips_per_truck || 0).toFixed(1)"/>
                                    <small class="text-muted">Trips per Truck/Week</small>
                                </div>
                                <hr class="my-2"/>
                                <div class="text-center">
                                    <h6 class="text-primary mb-0" t-esc="state.data.truck_performance?.weekly_activity || 0"/>
                                    <small class="text-muted">Weekly Activity Count</small>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-primary btn-sm btn-block" t-on-click="() => this.onCardAction('truck_efficiency')">
                                    <i class="fa fa-chart-bar"/> View Details
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Top Performer Card -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary d-flex justify-content-between align-items-center">
                                <h5 class="m-2"><i class="fa fa-trophy m-2"/>Top Performer</h5>
                                <span class="badge badge-light" style="font-size: 1.5rem;" t-esc="state.data.truck_performance?.top_truck_trips || 0"/>
                            </div>
                            <div class="position-absolute" style="top: 10px; right: 10px; opacity: 0.1;">
                                <i class="fa fa-trophy" style="font-size: 3rem;"/>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-2">
                                    <h5 class="text-success mb-1" t-esc="state.data.truck_performance?.top_truck_name || 'N/A'"/>
                                    <small class="text-muted">Highest Trip Count</small>
                                </div>
                                <hr class="my-2"/>
                                <div class="text-center">
                                    <h6 class="text-info mb-0" t-esc="(state.data.truck_performance?.avg_per_truck || 0).toFixed(1)"/>
                                    <small class="text-muted">Average per Truck</small>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-success btn-sm btn-block" t-on-click="() => this.onCardAction('truck_performance')">
                                    <i class="fa fa-list"/> View All
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Utilization Rate Card -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary d-flex justify-content-between align-items-center">
                                <h5 class="m-2"><i class="fa fa-percentage m-2"/>Utilization Rate</h5>
                                <span class="badge badge-light" style="font-size: 1.5rem;" t-esc="(state.data.truck_performance?.utilization_rate || 0) + '%'"/>
                            </div>
                            <div class="position-absolute" style="top: 10px; right: 10px; opacity: 0.1;">
                                <i class="fa fa-percentage" style="font-size: 3rem;"/>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-2">
                                    <h3 class="mb-0" t-att-class="'mb-0 text-' + this.getProgressColor(state.data.truck_performance?.utilization_rate || 0)" style="font-weight: 700;" t-esc="(state.data.truck_performance?.utilization_rate || 0) + '%'"/>
                                    <small class="text-muted">Active Trucks</small>
                                </div>
                                <div class="progress mb-2" style="height: 15px;">
                                    <div class="progress-bar" t-att-class="'progress-bar bg-' + this.getProgressColor(state.data.truck_performance?.utilization_rate || 0)" t-att-style="'width: ' + (state.data.truck_performance?.utilization_rate || 0) + '%'"/>
                                </div>
                                <div class="d-flex justify-content-between" style="font-size: 0.7rem;">
                                    <span t-att-class="'text-' + this.getProgressColor(state.data.truck_performance?.utilization_rate || 0)"><i class="fa fa-circle"/> <t t-if="(state.data.truck_performance?.utilization_rate || 0) >= 80">Excellent</t><t t-elif="(state.data.truck_performance?.utilization_rate || 0) >= 50">Good</t><t t-else="">Low</t></span>
                                    <span class="text-muted">≥80% <i class="fa fa-check text-success"/> ≥50% <i class="fa fa-exclamation text-warning"/> &lt;50% <i class="fa fa-times text-danger"/></span>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-info btn-sm btn-block" t-on-click="() => this.onCardAction('truck_utilization')">
                                    <i class="fa fa-chart-pie"/> View Analysis
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Distribution Card -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100 shadow-sm">
                            <div class="card-header bg-primary d-flex justify-content-between align-items-center">
                                <h5 class="m-2"><i class="fa fa-chart-bar m-2"/>Activity Distribution</h5>
                                <span class="badge badge-light" style="font-size: 1.5rem;" t-esc="state.data.truck_performance?.total_trucks || 0"/>
                            </div>
                            <div class="position-absolute" style="top: 10px; right: 10px; opacity: 0.1;">
                                <i class="fa fa-chart-bar" style="font-size: 3rem;"/>
                            </div>
                            <div class="card-body">
                                <div class="mb-3" style="cursor: pointer;" t-on-click="() => this.onCardAction('busy_trucks')">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small class="text-muted">High Activity</small>
                                        <span class="badge badge-success" t-esc="state.data.truck_performance?.high_activity || 0"/>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-success" t-att-style="'width: ' + ((state.data.truck_performance?.high_activity || 0) / Math.max(state.data.truck_performance?.total_trucks || 1, 1) * 100) + '%'"/>
                                    </div>
                                </div>
                                <div class="mb-3" style="cursor: pointer;" t-on-click="() => this.onCardAction('active_trucks')">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small class="text-muted">Moderate Activity</small>
                                        <span class="badge badge-warning" t-esc="state.data.truck_performance?.moderate_activity || 0"/>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-warning" t-att-style="'width: ' + ((state.data.truck_performance?.moderate_activity || 0) / Math.max(state.data.truck_performance?.total_trucks || 1, 1) * 100) + '%'"/>
                                    </div>
                                </div>
                                <div class="mb-3" style="cursor: pointer;" t-on-click="() => this.onCardAction('idle_trucks')">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small class="text-muted">Idle Trucks</small>
                                        <span class="badge badge-danger" t-esc="state.data.truck_performance?.idle_trucks || 0"/>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-danger" t-att-style="'width: ' + ((state.data.truck_performance?.idle_trucks || 0) / Math.max(state.data.truck_performance?.total_trucks || 1, 1) * 100) + '%'"/>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-warning btn-sm btn-block" t-on-click="() => this.onCardAction('weekly_truck_activity')">
                                    <i class="fa fa-calendar-week"/> Weekly Activity
                                </button>
                            </div>
                        </div>
                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Loading State -->
            <div class="text-center p-5" t-if="state.loading">
                <i class="fa fa-spinner fa-spin fa-3x text-muted"/>
                <p class="mt-3 text-muted">Loading dashboard data...</p>
            </div>
        </div>
    </t>
</templates>